# Upcoming title

## Synopsis


## Pre-processing

### Loading libraries 

```{r message=FALSE}

library(stringr)
library(dplyr)
library(ggplot2)

```


### Load data into R

```{r cache=TRUE}

storms_df <- read.csv('repdata_data_StormData.csv.bz2', na.strings = c('NA', ''),
                      stringsAsFactors = FALSE)

```

### Examining raw data

```{r}

dim(storms_df)

sum(complete.cases(storms_df))

names(storms_df)

str(storms_df)

```


We take a close look at the `EVTYPE` variable which is extremely important for answering both questions addressed in this report. 

```{r}

unique_raw_events <- length(unique(storms_df$EVTYPE))
unique_raw_events

```


Although the official storm data documentation lists 48 storm events (page 6), our dataset includes `r unique_raw_events` different event types. 

An examination of the data reveals that the reason for that huge difference in event types is caused by using different wording for the same kind of events in the raw data. 

For instance, you can find more than 80 variations for the official event type term _Thunderstorm Wind_:

```{r }

as.data.frame(table(storms_df$EVTYPE, useNA = "ifany"))[666:747,]

```

This is caused by:

1. Modifications of the official event type name (e.g., THUNDERSTORM  WINDS or THUNDERSTORM) 

2. Typos (e.g., THUDERSTORM WINDS or THUNDERSTORM WINS)

However, 82563 observations tagged with the official term _Thunderstorm Wind_  are included in the dataset whereas most of the event name modifications just include a single observation.

This shows that in the majority of the cases the event reporters used the official event type name.

### Event type number reduction strategy

In order to reduce the number of event types to a fair amount, we use a simple quantitative approach consisting of 4 steps:

1. We convert the `EVTYPE` column to lower case and remove leading and trailing white spaces 

2. For each of the remaining unique event types we calculate how much it contributes to the overall compeleteness of the number of observations

3. We decide on a threshold and select those event types which contribute the most to the overall amount of observations

4. The remaining set is further reduced by merging similar storms events with different wording  

#### Step 1: Removing leading and trailing which spaces

```{r}

storms_df$EVTYPE <- tolower(storms_df$EVTYPE)

storms_df$EVTYPE <- str_trim(storms_df$EVTYPE)

paste0("Total number of unique event types after first pre-processing step: ",
       length(unique(storms_df$EVTYPE)))

```


#### Step 2: Calculating the cumulative percentage that each event type contributes to the total amount of observations

```{r}

storms_by_evtype_df <- group_by(storms_df, EVTYPE) %>%
  summarize(
    numb_of_occ = n()
    ) %>%
  mutate(
    contrib_in_percent = round(numb_of_occ / nrow(storms_df), digits = 7),
    cumb_contrib_in_percent = round(
      order_by(desc(numb_of_occ), cumsum(contrib_in_percent)), digits = 7
      )
    ) %>%
  arrange(desc(numb_of_occ))

print.data.frame(storms_by_evtype_df[1:50, ])


```

As the table above shows, the first 46 event types already make up for 99 % of the total amount of observations. 

This can be shown even better when plotting the grouped data.


```{r cumulativeContributionFunction}

storms_by_evtype_df$rank <- 1:nrow(storms_by_evtype_df)

ggplot(storms_by_evtype_df, aes(rank, cumb_contrib_in_percent)) + 
  geom_line(color = 'steelblue') + 
  xlab('Number of included event types (ordered by descending percentage contribution)') +
  ylab('Observation completeness (in %)') +
  ggtitle('Cumulative observation completeness') + 
  theme_bw() +
  scale_x_continuous(breaks=seq(0, nrow(storms_by_evtype_df) , by = 100))

```

Especially, the last `r length(storms_by_evtype_df$numb_of_occ[storms_by_evtype_df$numb_of_occ < 6])` event types only contribute a tiny fraction to the overall percentage completeness of the obervations, due to the fact that less than 6 observations belong to each of those event types. The last `r length(storms_by_evtype_df$numb_of_occ[storms_by_evtype_df$numb_of_occ == 1])` event types even only contribute a single observation. 


#### Step 3: Choosing the event types which contribute the most to the amount of observations




### Processing data


## Results

Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?

Across the United States, which types of events have the greatest economic consequences?
